; *****************************************************
; *   Auto halt the making process when any error occur
; *   Version 1.0
; *   Author: quyenlv@dasannetworks.com
; *   Date: September 20th 2014
; *****************************************************
include 'boxConfig.ttl'

; Hide MACRO dialogue box
;show -1

; Open Serial connection using COM port.
; Valid value for port number is 1..6.
filesearch com_file
if result=1 then
    fileopen fhandle com_file 0
    filereadln fhandle _constr
    fileclose fhandle
else
    goto _end
endif

:connect
; Open serial connection
connect _constr
if result != 2 then
    yesnobox 'Connection fail. Try again?' 'TTY Caution'
    if result then
        goto login
    else
        goto _end
    endif
endif

; Asking for save information
ifdefined _comport
if result then
    yesnobox 'Do you want to save?' 'Connection successful'
    if result then
       fileopen fhandle com_file 0
       filewrite fhandle _constr
       fileclose fhandle
    endif
endif

; Entering synchronous communication mode (useful in most cases)
setsync 1

; Assigning new title to TeraTerm window
settitle 'TTY_BOX'
setmulticastname 'TTY_BOX'

; Start here
:main_loop
wait make_msg
sendmulticast 'Dev65' make_msg 13 10

; Minimum delay time between each build
pause 5

; Loop for the new make process
goto main_loop

:_end
; Make sure the connection is on before disconnect
testlink
if result= 2 then
    disconnect
    closett
endif
end